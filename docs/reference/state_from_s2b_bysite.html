<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Get State each site is entirely within, quickly, from table of blockid, ejam_uniq_id — state_from_s2b_bysite • EJAM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get State each site is entirely within, quickly, from table of blockid, ejam_uniq_id — state_from_s2b_bysite"><meta name="description" content="Find the 2-character State abbreviation, but only for sites entirely in 1 state."><meta property="og:description" content="Find the 2-character State abbreviation, but only for sites entirely in 1 state."><meta property="og:image" content="https://usepa.github.io/EJAM/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-warning me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview for EJAM Users</h6></li>
    <li><a class="dropdown-item" href="../articles/0_whatis.html">What is EJAM</a></li>
    <li><a class="dropdown-item" href="../articles/0_webapp.html">Using EJAM</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For analysts using R</h6></li>
    <li><a class="dropdown-item" href="../articles/1_installing.html">Installing the EJAM R package</a></li>
    <li><a class="dropdown-item" href="../articles/2_quickstart.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/3_analyzing.html">Basics of Using EJAM for Analysis in RStudio</a></li>
    <li><a class="dropdown-item" href="../articles/4_advanced.html">Advanced Features</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USEPA/EJAM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Get State each site is entirely within, quickly, from table of blockid, ejam_uniq_id</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM/blob/HEAD/R/state_from_s2b_bysite.R" class="external-link"><code>R/state_from_s2b_bysite.R</code></a></small>
      <div class="d-none name"><code>state_from_s2b_bysite.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Find the 2-character State abbreviation, but only for sites entirely in 1 state.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">state_from_s2b_bysite</span><span class="op">(</span><span class="va">sites2blocks</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sites-blocks">sites2blocks<a class="anchor" aria-label="anchor" href="#arg-sites-blocks"></a></dt>
<dd><p>data.table or data.frame, like <a href="testoutput_getblocksnearby_10pts_1miles.html">testoutput_getblocksnearby_10pts_1miles</a>,
from <code><a href="getblocksnearby.html">getblocksnearby()</a></code> that has columns ejam_uniq_id and blockid and distance</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data.table with columns  ejam_uniq_id, ST</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This only works for sites entirely in 1 state.
For multistate sites, need lat/lon of site and that is slower.
This returns NA for any site whose nearby blocks are in multiple states.
For multistate sites, you need to know the lat/lon of the site to be sure of its state.</p>
<p>This function is for when you need to quickly find out the state each site is in,
to be able to report state percentiles, This can identify the State
each site is located in, based on the states of the nearby blocks (and parent blockgroups).
In many analyses, all the sites will be single-state sites, and this function will be sufficient.</p>
<p>However, for the rare edge case where you did not save the lat,lon of sites you analyzed,
you would need to approximate those from the lat/lon of the blocks and their distances,
via latlon_from_s2b(), separately.</p>
<p>These two functions differ – one gets the state info for each unique site,
and the other gets the state abbreviation of each unique block:
Note: unexported function
xx = state_from_s2b_bysite(testoutput_getblocksnearby_10pts_1miles)[]
NROW(xx)
1 10
length(unique(testoutput_getblocksnearby_10pts_1miles$ejam_uniq_id))
1 10</p>
<p>length(EJAM:::state_from_blockid_table(testoutput_getblocksnearby_10pts_1miles))
1 1914
NROW(testoutput_getblocksnearby_10pts_1miles)
1 1914</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="state_from_blockid_table.html">state_from_blockid_table()</a></code> <code><a href="state_per_site_for_doaggregate.html">state_per_site_for_doaggregate()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span><span class="co"># unexported function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="state_from_blockid_table.html">state_from_blockid_table</a></span><span class="op">(</span><span class="va">testoutput_getblocksnearby_10pts_1miles</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">state_from_s2b_bysite</span><span class="op">(</span><span class="va">testoutput_getblocksnearby_10pts_1miles</span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="getblocksnearby.html">getblocksnearby</a></span><span class="op">(</span><span class="va">pts</span>, radius <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="fu">state_from_s2b_bysite</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">in_how_many_states</span><span class="op">)</span></span>
<span>  <span class="va">y</span></span>
<span></span>
<span>  <span class="va">fname</span> <span class="op">=</span> <span class="st">'./inst/testdata/testpoints_207_sites_with_signif_violations_NAICS_326_ECHO.csv'</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu">state_from_s2b_bysite</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="getblocksnearby.html">getblocksnearby</a></span><span class="op">(</span> <span class="fu"><a href="latlon_from_anything.html">latlon_from_anything</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span>, quadtree <span class="op">=</span> <span class="va">localtree</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="read_csv_or_xl.html">read_csv_or_xl</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">ST</span> <span class="op">==</span> <span class="va">y</span><span class="op">$</span><span class="va">FacState</span></span>
<span>  <span class="op">}</span> <span class="co"># }</span></span>
<span>  <span class="fu">state_from_s2b_bysite</span><span class="op">(</span><span class="va">testoutput_getblocksnearby_10pts_1miles</span><span class="op">)</span> </span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>US EPA 2024</p>
</div>

<div class="pkgdown-footer-right">
  <p>EJAM Version 2.32.0</p>
</div>

    </footer></div>





  </body></html>

